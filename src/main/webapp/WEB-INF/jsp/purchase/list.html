<!-- html block -->
<div class="sidebar sidebar-left mm-box">
	<div class="sidemenu" id="muAdd">
		<i class="icon icon-plus-6">添加</i>
	</div>
</div>
<div class="row mt-20">
	<div class="col-sm-8 col-sm-offset-2 mm-box form-horizontal filter-pan">
		<form id="query" onsubmit="return false;">
			<div class="form-group">
				<label class="control-label col-md-2">条形码</label>
				<div class="col-md-10">
					<input class="holo", type="text", name="barcode", id="barcode", style="display: inline-block;margin-right:10px;width:300px;">
					<button class="btn btn-primary m-l-5", data-toggle="modal", type="submit", id="queryQuick">
						<i class="icon-search-8" style="margin-right: 5px;"s></i>
						<span>快速查找</span>
					</button>
				</div>
			</div>
			<div class="form-group">
				<label class="control-label col-md-2">商品类型</label>
				<div class="btn-group" data-toggle="buttons-radio", id="area", name="area">
					<button class="btn btn-sm btn-light-info active" value="">全部</button>
					<button class="btn btn-sm btn-light-info" value="1">黄金</button>
					<button class="btn btn-sm btn-light-info" value="2">铂金</button>
					<button class="btn btn-sm btn-light-info" value="3">翡翠</button>
				</div>
			</div>
		</form>
	</div>
</div>

<div class="modal fade" tabindex="-1", data-width="760", id="add", style="display: none;">
	<form id="formAdd" action="purchase/add">
		<div class="modal-header">
			<button class="close"type="button", data-dismiss="modal", aria-hidden="true"> &times</button>
			<div class="row">
				<div class="col-md-3">
					<h4 class="modal-title">添加采购信息</h4>
				</div>
			</div>
		</div>
		<div class="modal-body">
			<div class="row m-t-20">
				<span class="col-md-2 text-right text-muted small">名称</span>
				<div class="col-md-3">
					<input class="holo required", type="text", style="margin-top:-20px;width:170px", id="name", name="name">
				</div>
				<span class="col-md-2 text-right text-muted small">总成本</span>
				<div class="col-md-3">
					<input class="holo digits", type="text", style="margin-top:-20px;width:170px", id="amount", name="amount">
				</div>
				<span class="col-md-1 text-left text-muted small">元</span>
			</div>
			<div class="row" style="margin-top:20px;">
				<div class="col-md-10 col-md-offset-1">
					<input class="holo", type="text", style="width: 100%;", placeholder="备注", id="comment", name="comment">
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<div class="text-center">
				<button class="cancel btn btn-lg btn-default" id="cancel" style="margin-right: 40px;", type="button">取消</button>
				<button class="btn btn-lg btn-success" id="submit", type="submit">确定</button>
			</div>
		</div>
	</form>
</div>

<div class="modal fade" tabindex="-1", data-width="760", id="modify", style="display: none;">
	<form id="formModify" action="purchase/modify">
		<div class="modal-header">
			<button class="close"type="button", data-dismiss="modal", aria-hidden="true"> &times</button>
			<div class="row">
				<div class="col-md-3">
					<h4 class="modal-title">修改采购信息</h4>
				</div>
			</div>
		</div>
		<div class="modal-body">
			<div class="row m-t-20">
				<span class="col-md-2 text-right text-muted small">名称</span>
				<div class="col-md-3">
					<input type="hidden" id="id" name="id">
					<input class="holo required", type="text", style="margin-top:-20px;width:170px", id="name", name="name">
				</div>
				<span class="col-md-2 text-right text-muted small">总成本</span>
				<div class="col-md-3">
					<input class="holo number", type="text", style="margin-top:-20px;width:170px", id="amount", name="amount">
				</div>
				<span class="col-md-1 text-left text-muted small">元</span>
			</div>
			<div class="row" style="margin-top:20px;">
				<div class="col-md-10 col-md-offset-1">
					<input class="holo", type="text", style="width: 100%;", placeholder="备注", id="comment", name="comment">
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<div class="text-center">
				<button class="cancel btn btn-lg btn-default" id="cancel" style="margin-right: 40px;", type="button">取消</button>
				<button class="btn btn-lg btn-success" id="submit", type="submit">确定</button>
			</div>
		</div>
	</form>
</div>

<div class="modal fade" id="opDelConfirm" tabindex='-1', style='display: none;'>
	<div class="modal-body">
		<p id="confirmMsg">确定删除？
	</div>
	<div class="modal-footer">
		<div class="text-center">
			<button class="cancel btn btn-default" style='margin-right: 40px;', data-dismiss='modal'>取消</button>
			<button id="ok" class="btn btn-danger">确定</button>
		</div>
	</div>
</div>

<div class="row m-t-25">
	<div class="col-sm-8 col-sm-offset-2">
		<div class="row" id="purchaseListData"></div>
	</div>
</div>

<!-- script block -->
<script type="text/javascript">
var purchasePagination = new pup.Pagination({
    templateKey : "purchase.listData"
});
//跳转到第一页
purchasePagination.setSort({ctime:"DESC"}).first();

$("#cancel, .close").click(function() {
    $(".modal").modal("hide");
    $(".popover").each( function() {
        $(this).hide();
    });
});

$("#muAdd").click(function() {
    $("#add").modal("show");
    $("#formAdd").validate_popover({onsubmit: false, popoverPosition: "top"});
    $("#add").on("scroll", function() { $.validator.reposition(); });
    $("#add").on("hide.bs.modal", function (e) {
       $(".popover").each( function() {
          $(this).hide();
       });
    });
    $(window).resize(function() {
        $.validator.reposition();
     });
});

$("#formAdd").submit(function(ev) {
    ev.preventDefault();
    if($("#formAdd").validate().form()) {
        var url = $(this).attr("action");
        var formData = $(this).serializeObject();
        $.ajax({
            type: "POST",
            url: url,
            dataType: "json",
            data: formData,
            success: function (data) {
                if(data.msg.type == "success") {
                    $("#formAdd")[0].reset();
                    $("#add").modal("hide");
                    purchasePagination.first();
                }
                toast(data.msg);
            }
        });
    }
    return false;
});

var curOrderId = 0;

$('#opDelConfirm #ok').click(function() {
    $('#opDelConfirm').modal('hide');
    var url = 'purchase/' + curOrderId;
    $.ajax({
        type: 'DELETE',
        url: url,
        dataType: 'json',
        data: {},
        success: function (data) {
            var formData = data.msg.body;
            if(data.msg.type == 'success'){
            	purchasePagination.reload();
            }
            toast(data.msg);

        }
    });
});

</script>

